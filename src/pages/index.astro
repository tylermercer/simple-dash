---
import Layout from "@layouts/Base.astro";
---

<Layout>
  <!--Everything after this is horrible ChatGPT code i added from my phone as a POC ðŸ˜…-->
  <form class="u-guttered" id="bookmark-form">
    <input type="text" id="bookmark-title" placeholder="Title" required />
    <input type="url" id="bookmark-url" placeholder="URL" required />
    <button type="submit">Add Bookmark</button>
  </form>

  <ul id="bookmark-list" class="bookmark-list"></ul>
</Layout>

<style>
  .bookmark-list {
    list-style-type: none;
    padding: 0;
  }
  .bookmark-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }
  .actions button {
    margin-left: 0.5rem;
  }
</style>

<script>
  // Select elements
  const form = document.getElementById("bookmark-form") as HTMLFormElement;
  const titleInput = document.getElementById(
    "bookmark-title",
  ) as HTMLInputElement;
  const urlInput = document.getElementById("bookmark-url") as HTMLInputElement;
  const bookmarkList = document.getElementById(
    "bookmark-list",
  ) as HTMLUListElement;

  type Bookmark = {
    title: string;
    url: string;
  };

  // Load bookmarks from localStorage
  let bookmarks = (JSON.parse(localStorage.getItem("bookmarks") || "[]") ||
    []) as Bookmark[];

  bookmarks.forEach((bookmark, index) => addBookmarkToDOM(bookmark, index));

  // Add a bookmark to the DOM
  function addBookmarkToDOM(bookmark: Bookmark, index: number) {
    const li = document.createElement("li");
    li.className = "bookmark-item";
    li.dataset.index = "" + index;

    const link = document.createElement("a");
    link.href = bookmark.url;
    link.textContent = bookmark.title;

    const deleteButton = document.createElement("button");
    deleteButton.textContent = "Delete";
    deleteButton.addEventListener("click", () => deleteBookmark(index));

    li.appendChild(link);
    li.appendChild(deleteButton);
    bookmarkList.appendChild(li);
  }

  // Remove all child nodes (to re-render the list efficiently)
  function clearList() {
    while (bookmarkList.firstChild) {
      bookmarkList.firstChild.remove();
    }
  }

  // Save bookmarks to localStorage
  function saveBookmarks() {
    localStorage.setItem("bookmarks", JSON.stringify(bookmarks));
  }

  // Add a bookmark
  form.addEventListener("submit", (event) => {
    event.preventDefault();
    const title = (titleInput as HTMLInputElement).value.trim();
    const url = (urlInput as HTMLInputElement).value.trim();

    if (title && url) {
      bookmarks.push({ title, url });
      saveBookmarks();
      clearList();
      bookmarks.forEach((bookmark, index) => addBookmarkToDOM(bookmark, index));
      form.reset();
    }
  });

  // Delete a bookmark
  function deleteBookmark(index: number) {
    bookmarks.splice(index, 1);
    saveBookmarks();
    clearList();
    bookmarks.forEach((bookmark, index) => addBookmarkToDOM(bookmark, index));
  }
</script>
